<!-- ...Previous HEAD/Imports/CSS from your code... -->

<div id="page1">
  <div class="glass mb-4">
    <div class="row align-items-end mb-0 pb-0">
      <div class="col-md-6">
        <select id="schemeDropdown" class="form-select form-select-sm"></select>
      </div>
      <div class="col-md-6">
        <div id="talukaChips"></div>
      </div>
    </div>
    <div class="text-end mt-3">
      <button id="resetBtn" class="btn btn-compact mb-2">ЁЯФД Reset</button>
      <button id="updateBtn" class="btn btn-compact mb-2">ЁЯФН Submit</button>
    </div>
  </div>
  <div class="glass">
    <div class="row-badges">
      <span><svg width="28" height="28"><circle cx="14" cy="14" r="13" fill="#ffd700" stroke="#fc0" stroke-width="1.5"/><text x="14" y="20" font-size="16" fill="#b68c00" font-weight="bold" text-anchor="middle">1</text></svg> TOP 5</span>
      <span><svg width="28" height="28"><circle cx="14" cy="14" r="13" fill="#e5e5e5" stroke="#aaa" stroke-width="1.5"/><text x="14" y="20" font-size="16" fill="#353535" font-weight="bold" text-anchor="middle">2</text></svg> рдордзреНрдпрдо 5</span>
      <span><svg width="28" height="28"><circle cx="14" cy="14" r="13" fill="#de9c68" stroke="#9c5c07" stroke-width="1.5"/><text x="14" y="20" font-size="16" fill="#fff" font-weight="bold" text-anchor="middle">3</text></svg> рддрд│ 5</span>
    </div>
    <div class="kpi-list" id="kpiList"></div>
    <div class="row row-cols-1 row-cols-md-2 g-3">
      <div class="col"><div class="chart-panel"><div class="chart-header">ЁЯУК рдХрд╛рд░реНрдпрдкреНрд░рджрд░реНрд╢рди рддреБрд▓рдирд╛</div>
        <div class="chart-container"><canvas id="barChart"></canvas></div></div></div>
      <div class="col"><div class="chart-panel"><div class="chart-header">ЁЯез рдкреНрд░рддрд┐рд╢рдд рд╡рд╛рдЯрдк</div>
        <div class="chart-container"><canvas id="donutChart"></canvas></div></div></div>
    </div>
    <div class="glass mt-3">
      <div style="font-weight:700;font-size:1.08em;margin-bottom:1em;">рддрд╛рд▓реБрдХреНрдпрд╛рдВрдЪреА рд╕рдВрдкреВрд░реНрдг рдорд╛рд╣рд┐рддреА рд╡ рд░рдБрдХрд┐рдВрдЧ</div>
      <div class="table-responsive" style="max-height:320px">
        <table class="table table-bordered table-sm text-center" id="blockDetailsTable">
          <thead class="sticky-top"><tr><th>рддрд╛рд▓реБрдХрд╛</th><th>рд░рдБрдХ</th></tr></thead>
          <tbody id="talukaRanksBody"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
function renderPage1(){
  const scheme = document.getElementById('schemeDropdown').value || schemes[0];
  // Actual rank calculation for the selected scheme
  const all = rawData.map(r=>({b:r._block,rank:parseInt(r[scheme])||999})).sort((a,b)=>a.rank-b.rank);
  document.getElementById('kpiList').innerHTML = all.map((t,i)=>`
    <div class="kpi-badge ${i<5?'top':i<10?'mid':'bot'}" data-block="${t.b}">
      ${i<3?svgMedal(i+1):''}
      <span class="taluka">${t.b}</span>
      <span style="margin-left:.52em;">#${isFinite(t.rank) ? t.rank : '-'}</span>
    </div>
  `).join('');
  // Bar chart: rank as y-value, colored
  const pal = ["#6366f1","#10b981","#f59e0b","#ef4444","#3b82f6","#818cf8"];
  barChart?.destroy();donutChart?.destroy();
  barChart=new Chart(document.getElementById('barChart').getContext('2d'),{
    type:'bar',
    data:{labels:all.map(x=>x.b),datasets:[{data:all.map(x=>isFinite(x.rank)?x.rank:0),backgroundColor:pal,borderRadius:8}]},
    options:{indexAxis:'y',plugins:{legend:{display:false},datalabels:{anchor:'end',align:'right',formatter:v=>`#${v>0?v:'-'}`}},
    responsive:true,maintainAspectRatio:false},plugins:[ChartDataLabels]
  });
  // Donut chart: percentage share of all ranks
  donutChart=new Chart(document.getElementById('donutChart').getContext('2d'),{
    type:'doughnut',
    data:{labels:all.map(x=>x.b),datasets:[{data:all.map(x=>isFinite(x.rank)?x.rank:0),backgroundColor:pal}]},
    options:{plugins:{legend:{position:'bottom'},datalabels:{formatter:v=>`#${v>0?v:'-'}`}},responsive:true,maintainAspectRatio:false},plugins:[ChartDataLabels]
  });
  // Table: show actual ranks
  document.getElementById('talukaRanksBody').innerHTML=all.map((x,i)=>`<tr class="${i<5?'top':i<10?'mid':'bot'}">
    <td>${x.b}</td><td style="font-size:1.08em"><b>${isFinite(x.rank)?x.rank:'-'}</b></td>
  </tr>`).join('');
}
</script>
